#!/usr/bin/env python3
"""
Fix placeholder translations by matching Arabic words to English verse context.
"""

import json
import re
from pathlib import Path

# Comprehensive Arabic to English dictionary
TRANSLATIONS = {
    # Common verbs
    'وَلكِنَّنَا': 'but we',
    'لِيَصِيرَ': 'to become',
    'إِذَنْ،': 'Therefore',
    'كَأَنَّكَ': 'as if you',
    'أَلَسْتُمْ': 'Are you not',
    'وَالْبَطْنُ': 'and the stomach',
    'غَيْرُ': 'not',
    'حِينَ': 'when',
    'كُلَّهُ': 'all',
    'مِنْهُمْ': 'of them',
    'وُجِدَتْ': 'was created',
    'أَحْرَاراً،': 'free',
    'وَالْمَحَبَّةُ.': 'and love.',
    'الْمِزْمَارُ': 'the pipe',
    'الآنَ،': 'now',
    'أَخْضَعَ': 'put',
    'فَأَيُّ': 'what',
    'فَهُوَ': 'he is',
    'الإِخْوَةُ،': 'brothers and sisters,',
    'فَيَذْهَبُونَ': 'they will go',
    'بِالصَّلاةِ': 'by your prayers',
    'رَبِّنَا': 'our Lord',
    'كَلامَنَا': 'our message',
    'الْمَسِيحِ': 'Christ',
    'الْمَسِيحَ': 'Christ',
    'الْمَسِيحِ،': 'Christ,',
    'الإِنْسَانَ': 'the man',
    'مُقِيمِينَ': 'at home',
    'إِنْجِيلاً': 'gospel',
    'قَضَّيْتُ': 'I spent',
    'السُّورِ،': 'the wall,',
    'يَنْطِقَ': 'to tell',
    'شَيْئاً.': 'nothing.',
    'وَلكِنِّي': 'but I',
    'مُلُوحَتَهُ؟': 'its saltiness?',
    'الضَّفَّةِ': 'the shore',
    'يَسْأَلُونَهُ:': 'asking him:',
    'أَقُولُ': 'I say',
    'الْكَهَنَةَ': 'the priests',
    'أُحْضِرَ': 'was brought',
    'كَثِيرُونَ،': 'many,',
    'الأَرْغِفَةَ': 'the loaves',
    'تَلامِيذَهُ:': 'his disciples:',
    'وَعَيْنُكَ': 'and your eye',
    'كَالْوَثَنِيِّ': 'as a pagan',
    'سَوْفَ': 'will',
    'إِلَيْكِ': 'to you',
    'اتَّجَهَ': 'turned',
    'عَنْهَا': 'about her',
    'وَالأَمِينُ!': 'and faithful!',
    'الْفِضَّةِ': 'the silver',
    "'حَقَلْ دَمَخْ'": "'Field of Blood'",
    'مُبَشِّرِينَ': 'preaching',
    'فَيُذْهِلُ': 'astonishing',
    'حَالاً': 'immediately',
    'مَعَهُ': 'with him',
    'إِلَيَّ': 'to me',
    'فَتَذَكَّرْتُ': 'Then I remembered',
    'عَلَيْهِمِ': 'on them',
    'الأَمَانَ،': 'safety,',
    'تَوَجَّهَا': 'they went',
    'تَعْلِيمِ': 'teaching',
    'الْيَهُودِ': 'the Jews',
    'بُطْرُسُ': 'Peter',
    'وَالشُّيُوخُ': 'and the elders',
    'الْجَوَّالِينَ': 'itinerant',
    'بِمُقَاطَعَتَيْ': 'in the provinces of',
    'قَدِيمٌ،': 'old,',
    'أَمَّا': 'As for',
    'أَبْصِرْ.': 'see.',
    'يَرْفُضُونَ': 'reject',
    'طَلَعَ': 'rose',
    'سَبْعُونَ': 'seventy',
    'وَأَشَارَ': 'and motioned',
    'أَقُومُ': 'I will arise',
    'فَقُلْتُ': 'I said',
    'تَحْمِلُنَا': 'carrying us',
    'وَرَاءَهُ،': 'behind him,',
    'اخْتَارَ': 'chose',
    'رُوحِي': 'my spirit',
    'حَيْثُ': 'where',
    'أَنْتُمْ': 'you',
    'حَاجَاتِي': 'my needs',
    'طُوبَى': 'Blessed',
    'ابْنِ': 'son of',
    'يَشْكُرُ': 'gives thanks',
    'تَنْكَمِشُ': 'shrinks',
    'يَصْمُدَ،': 'stand,',
    'يَدْخُلَ': 'enter',
    'الْبَيْتَ،': 'the house,',
    'أَحَدٌ': 'anyone',
    'الْحَجَرُ': 'The stone',
    'الْقِيَامَةِ،': 'the resurrection,',
    'أُنْكِرُكَ': 'disown you',
    'بَعْدَمَا': 'after',
    'النَّاسُ': 'the people',
    'هَرَبُوا': 'fled',
    'وُجِدَ': 'was found',
    'الآيَةَ': 'the sign',
    'فَقَدِيماً': 'long ago',
    'يَتَقَبَّلُهَا،': 'accepts it,',
    'عَطِيَّةٌ': 'gift',
    'الْكِتَابِ': 'the Scripture',
    'يَقُولُ': 'says',
    'لِيُخْلِصَكُمُ': 'to save you',
    'يُصَلُّونَ': 'pray',
    'فَفِي': 'For in',
    'النِّعْمَةُ': 'grace',
    'يُنْجِيَنَا': 'rescue us',
    'رُوحَ': 'spirit of',
    'الْمَوْتَى': 'the dead',
    'يُعْطِيكُمُ': 'give you',
    'بِاللهِ،': 'in God,',
    'يُعْطِيهَا': 'gives it',
    'لِعَدَاوَتِهِمْ': 'because of their hostility',
    'يَتَرَدَّدُ': 'doubts',
    'اسْتَحِقُّوا': 'consider worthy',
    'فَإِنْ': 'For if',
    'يَعْتَرِفْ': 'acknowledge',
    'لأَنَّنِي': 'because I',
    'رُوحَهُ،': 'his spirit,',
    'لَنْ': 'will not',
    'صَخْرَةً': 'a rock',
    'دَائِماً': 'always',
    'الأَشْيَاءَ': 'all things',
    'يَحْسِبُونَ': 'consider',
    'تَعُودَ': 'return',
    'الدُّنْيَا': 'the world',
    'لِكَيْ': 'in order that',
    'تَضْرِبُهُمْ': 'strike them',
    'الضَّرْبَةُ': 'the plague',
    'وَالدَّمُ': 'and blood',
    'هُمْ': 'they',
    'تَبْقَى': 'remains',
    'الثَّالِثُ': 'the third',
    'الرَّابِعُ': 'the fourth',
    'لِيُعَمِّدُوهُ': 'to baptize him',
    'الْبُحَيْرَةِ': 'the lake',
    'الْكِبْرِيتُ': 'sulfur',
    'الْبَقِيَّةُ': 'the rest',
    'الثَّانِي': 'the second',
    "'إِلَى": "'To",
    "الْمَجْهُولِ'.": "the Unknown.'",
    # Additional translations for remaining words
    'كُنَّا': 'we were',
    'بِهِ': 'in it',
    'حَقّاً': 'truly',
    'السَّبْتِ.': "Sabbath day's.",
    "'حَقَلْ دَمَخْ'": "'Hakeldama'",
    'الصَّامِتِ': 'the silent',
    'سَمِعُوهُمْ': 'they heard them',
    'السَّمَاءِ.': 'heaven.',
    'أَنْطَاكِيَةَ': 'Antioch',
    'أَحُلَّ': 'to untie',
    'قَوْلِهِ:': 'saying:',
    'الْمَجَامِعِ': 'the synagogues',
    'تُكْسِبُ': 'earned',
    '«هَذَانِ': '"These',
    'وَسَمِعَ': 'and heard',
    'رَئِيسَ': 'the leader',
    'وَمَعَ': 'and with',
    '«تَعْلَمُونَ': '"You know',
    'الأَمْرُ': 'the matter',
    'تَهْدِئَةِ': 'quieting',
    'مُقَاطَعَةِ': 'the province of',
    'الْمَدِينَةِ': 'the city',
    'وَيُلَوِّحُونَ': 'and waving',
    'رُومَانِيُّ': 'a Roman',
    'وَهُنَاكَ': 'and there',
    'دِفَاعَ': 'defense',
    'الْقَيْصَرِ!»': 'to Caesar!"',
    'قَالَ': 'said',
    'وَصَلَتْ': 'reached',
    'بُوطِيُولِي': 'Puteoli',
    'السَّمَاوَاتِ،': 'heaven,',
    'الظَّلامِ': 'darkness',
    'وَسُلْطَةٍ؛': 'and authority;',
    'لاوُدِكِيَّةَ': 'Laodicea',
    'وَذَلِكَ': 'and this',
    'مَدْحِ': 'praise',
    'الْمُؤْمِنِينَ،': 'who believe,',
    'أَيْضاً': 'also',
    'وَاحِداً': 'one',
    'مَدَى': 'the scope',
    'وَفْقاً': 'according',
    'الْمَسِيحِ.': 'Christ.',
    'بِالصِّدْقِ': 'truthfully',
    'كَمَنْ': 'as',
    'تَخْرِيبِهَا،': 'destroying it,',
    'فَانْدَسُّوا': 'infiltrated',
    'الَّذِي': 'who',
    'يَسْتَحِقُّ': 'deserving',
    'عُدْتُ': 'I rebuild',
    'مُعْجِزَاتٍ': 'miracles',
    'فَهَلْ': 'Is then',
    'فَاحْذَرُوا': 'watch out',
    'الأَهْوَاءِ': 'passions',
    'مَصْلُوباً.': 'crucified.',
    'لأَنْوَاعِهَا».': 'according to their kinds."',
    'وَيَعْتَنِيَ': 'and to take care of',
    'فَعَلْتِ': 'you have done',
    'مَلْعُونَةٌ': 'cursed',
    'وَيَقْتُلُنِي': 'and kill me',
    'مَتُوشَائِيلُ': 'Methushael',
    'وَشَابّاً': 'and a young man',
    'تَقْتُلْ!': 'murder!',
    'الْمَحْكَمَةِ،': 'court,',
    'تَحْلِفُوا': 'swear',
    'تَخَافُوا': 'be afraid',
    'وَكُلُّ': 'and whoever',
    'وَازْدِرَاءَ': 'and slander',
    'لَهُ': 'to him',
    'وَجَاءَ': 'and went',
    'يَا': 'O',
    'تَعَالَوْا': 'Come',
    'اسْمِي؛': 'my name;',
    'لَكُمُ': 'to you',
    'تَبْذُرْ،': 'did not sow,',
    'يَشْرَبَهَا.': 'drink it.',
    'أَنْ ي': 'to',
    'قَبِلَنِي.': 'welcomes me.',
    'الطَّرِيقِ،': 'his way,',
    'هَذَا': 'this',
    'وَقَالَ': 'and said',
    'الْبَابِ': 'the doorway',
    'فَأَخَذُوا': 'they began',
    'مَرَّةً': 'again',
    'لَمْ': 'did not',
    'ثَانِيَةٌ': 'second',
    'أَلْقَتْ': 'has put',
    'لَدَيْكَ.': 'for you.',
    'هذِهِ': 'this',
    'يُجِبْ': 'gave answer',
    'هَيْكَلُ': 'temple',
    'هُوَ': 'is',
    'الْوَيْلُ': 'woe',
    'لأَنَّهُ': 'because he',
    'خَلَقَ': 'made',
    'الْمُتَّقِدِ،': 'burning,',
    'الأَرْبَعَةِ': 'the four',
    'وَيَنَابِيعِ': 'and springs of',
    'فَاحْتَرَقَ': 'They were seared',
    'الشَّيْطَانِيَّةُ': 'demonic',
    'الْمَرْأَةُ': 'The woman',
    'بِالنَّارِ،': 'by fire,',
    'التُّجَّارُ': 'The merchants',
    'مُنْتَحِبِينَ:': 'cry out:',
    'هَلِّلُويَا!»': 'Hallelujah!"',
    'وَعَلَى': 'and on',
    'بِالشَّيَاطِينِ': 'idolaters',
    'وَسَاحَةُ': 'and the street',
    'الشَّرِيعَةِ،': 'the law,',
    'دَاوُدُ': 'David',
    'فَبِالرَّجَاءِ': 'in hope',
    'حُسِبَ': 'was credited',
    'فَإِنَّنَا': 'For if we',
    'مَرَّةً': 'once',
    'الْمَوْتُ،': 'death,',
    'فَإِنَّكُمْ': 'you also',
    'لَا': 'do not',
    'ْ سَتَمُوتُونَ،': 'you will die,',
    'سَتَمُوتُونَ،': 'you will die,',
    'وَلَمْ': 'and had not',
    'بِرَحْمَةِ': 'on mercy',
    'فَخّاً': 'a snare',
    'بَعْضاً': 'some',
    'هُمْ،': 'them,',
    'فَكَمَا': 'For just as',
    'بِاجْتِهَادٍ؛': 'diligently;',
}

def fix_placeholders():
    """Fix all placeholder translations."""
    mappings_dir = Path('bible-translations/mappings')
    fixed = 0
    remaining = 0

    for book_dir in sorted(mappings_dir.iterdir()):
        if not book_dir.is_dir() or book_dir.name in ['LUK', 'JHN']:
            continue

        for chapter_file in sorted(book_dir.glob('*.json'), key=lambda x: int(x.stem)):
            with open(chapter_file) as f:
                data = json.load(f)

            modified = False

            for verse_num, verse_data in data['verses'].items():
                for m in verse_data['mappings']:
                    if m['en'].startswith('[') and m['en'].endswith(']'):
                        ar_word = m['ar'].strip()

                        if ar_word in TRANSLATIONS:
                            m['en'] = TRANSLATIONS[ar_word]
                            fixed += 1
                            modified = True
                        else:
                            remaining += 1
                            print(f"{book_dir.name} {chapter_file.stem}:{verse_num} - '{ar_word}' still needs translation")
                            print(f"  English: {verse_data['en'][:80]}...")

            if modified:
                with open(chapter_file, 'w', encoding='utf-8') as f:
                    json.dump(data, f, ensure_ascii=False, indent=2)

    print(f"\nFixed {fixed} placeholder translations")
    print(f"Remaining: {remaining}")

if __name__ == "__main__":
    fix_placeholders()
