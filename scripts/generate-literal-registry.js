#!/usr/bin/env node

/**
 * Generate literalMappingsRegistry.js with static imports for all literal mappings
 * Required because React Native doesn't support dynamic require()
 */

const fs = require('fs');
const path = require('path');

const literalMappingsDir = path.join(__dirname, '../bible-maps-word/mappings');
const outputFile = path.join(__dirname, '../src/utils/literalMappingsRegistry.js');

// Collect all book/chapter combinations
const books = fs.readdirSync(literalMappingsDir).filter(f => {
  const stat = fs.statSync(path.join(literalMappingsDir, f));
  return stat.isDirectory();
}).sort();

let output = `/**
 * Auto-generated literal mappings registry
 * Generated by: node scripts/generate-literal-registry.js
 *
 * This file contains static imports for all literal word mappings
 * to work around React Native's limitation on dynamic require()
 */

`;

// Generate imports
books.forEach(book => {
  const bookPath = path.join(literalMappingsDir, book);
  const chapters = fs.readdirSync(bookPath)
    .filter(f => f.endsWith('.json'))
    .map(f => parseInt(f.replace('.json', '')))
    .sort((a, b) => a - b);

  chapters.forEach(chapter => {
    const importName = `L_${book}_${chapter}`;
    output += `import ${importName} from '../../bible-maps-word/mappings/${book}/${chapter}.json';\n`;
  });
});

output += `\n// Mapping registry\nconst literalMappings = {\n`;

// Generate registry object
books.forEach(book => {
  const bookPath = path.join(literalMappingsDir, book);
  const chapters = fs.readdirSync(bookPath)
    .filter(f => f.endsWith('.json'))
    .map(f => parseInt(f.replace('.json', '')))
    .sort((a, b) => a - b);

  output += `  '${book}': {\n`;
  chapters.forEach(chapter => {
    const importName = `L_${book}_${chapter}`;
    output += `    ${chapter}: ${importName},\n`;
  });
  output += `  },\n`;
});

output += `};\n\n`;

output += `/**
 * Get literal mapping for a book and chapter
 * @param {string} book - Book ID (e.g., 'MRK')
 * @param {number} chapter - Chapter number
 * @returns {object|null} Literal mapping data or null if not found
 */
export const getLiteralMapping = (book, chapter) => {
  return literalMappings[book]?.[chapter] || null;
};

/**
 * Check if literal mapping exists
 * @param {string} book - Book ID
 * @param {number} chapter - Chapter number
 * @returns {boolean}
 */
export const hasLiteralMapping = (book, chapter) => {
  return !!(literalMappings[book]?.[chapter]);
};
`;

// Write output file
fs.writeFileSync(outputFile, output);

console.log(`âœ“ Generated literalMappingsRegistry.js`);
console.log(`  Books: ${books.length}`);
console.log(`  Total mappings: ${books.reduce((sum, book) => {
  const bookPath = path.join(literalMappingsDir, book);
  const chapters = fs.readdirSync(bookPath).filter(f => f.endsWith('.json'));
  return sum + chapters.length;
}, 0)}`);
